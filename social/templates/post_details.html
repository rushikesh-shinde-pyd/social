{% extends 'base.html' %}
{% load staticfiles %}
{% load mathfilters %}
{% load c_filters %}
{% block title %} <title>{{ post.title|title }}</title>{% endblock %}
{% block content %}

     <!-- **********************************************************************************************************************************************************
    MAIN CONTENT
    *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content" style='overflow: hidden;'>
        <section class="wrapper">
            <!--<div class="row">-->
                <div class="col-lg-9 main-chart">
                    <!--.>&lt;!&ndash; /row mt &ndash;&gt;-->

                    <div class="row" style="overflow: hidden;">
                        <h3 style="" class="show-all-categories">Categories</h3>
                        <i title="Create new category" class="pointer fa fa-plus add-category" style="padding:5px; color: #31708f; margin: 0px 0px 10px 0px; font-size:20px;" aria-hidden="true"></i>
                        <form class="create-category" name="create-category" style="display: none; margin-bottom: 5px;" method="post" action="{% url 'social:create-category' %}">
                            {% csrf_token %}
                            <div style="display: inline-block; box-sizing: border-box; width: 35%;  overflow: hidden;">
                                <input type="text" required name="category-name" class="form-control" placeholder="Category name">
                                </div>
                            <div style="display: inline-block; box-sizing: border-box; width: 35%;  overflow: hidden;">
                                <input type="text" required name="subcategory-name" class="form-control" placeholder="Subcategory name">
                            </div>
                            <div id="create-btn" style="cursor: pointer; color: #fff;  padding: 7px;text-align: center; display: inline-block; box-sizing: border-box; width: 25%; background-color: #428bca; border: 1px solid #357ebd; border-radius: 3px; overflow: hidden;">
                                Create category
                            </div>
                        </form>
                        <div class="error-box">
                        
                        </div>
                        <div class="category-container" style="display: none; overflow: hidden; box-sizing: border-box;">
                            {% for each_category in categories_post %}
                                <div class="category-thumbnail {% if higlight_category == each_category%} higlight_category {% endif %} text-center">
                                    <a href="{% url 'social:category' each_category %}">
                                     {{ each_category|title }}
                                </a>
                                </div>
                                {% empty %}
                                    <div>
                                        <h3 class="text-center">:(</h3>
                                        <h6 class="text-center">No categories so far !</h6>
                                    </div>
                            {% endfor %}
                        </div>
                    </div>


                    <div class="row" style="margin-top: 5px;">
                        <!-- SERVER STATUS PANELS -->
                        <!--.&lt;!&ndash; /col-md-4&ndash;&gt;-->
                        <div class="col-md-12 col-sm-12 mb" >
                            <i title="Create new post" class="pointer fa fa-plus add-blog" style="padding:5px; color: #31708f; margin: 0px 0px 10px 0px; font-size:20px;" aria-hidden="true"></i>

                            <form name="post-create-form" class="post-create-form" style="display: none;" method="post" action="{% url 'social:post-create' %}">
                                {% csrf_token %}
                                <div class="form-group">
                                    <div style="overflow: hidden; box-sizing: border-box; margin-bottom: 10px;">
                                        <select required name="category" class="pull-left cat-sub-cat" style="">
                                            <option selected value="None">Select Category</option>
                                            {% for category in categories_post %}
                                                <option value="{{ category }}">{{ category|title }}</option>
                                            {% endfor %}
                                        </select>
                                        <select required name="subcategory" class="pull-left cat-sub-cat"  placeholder="Subcategory">
                                            <option selected value="None">Select Subcategory</option>
                                        </select>
                                        <span style="clear: both;"></span>
                                    </div>
                                    
                                    <p><input required type="text" name="post-title" class="form-control" placeholder="Post Title"></p>
                                    <p><textarea required style="resize:none;" name="post-content" class="form-control" rows="3" placeholder="What's on your mind!"></textarea></p>
                                    <p><button class="btn btn-sm btn-primary" type="submit" style="margin-top:10px;">POST</button></p>
                                </div>
                            </form>
                            <div class="post-error-box"></div>

                            <!-- 
                            <div class="row mtbox">
                                <div class="col-md-2 col-sm-2 col-md-offset-1 box0">
                                    <div class="box1">
                                        <span class="li_heart"></span>
                                        <h3>933</h3>
                                    </div>
                                        <p>933 People liked your page the last 24hs. Whoohoo!</p>
                                </div>
                                <div class="col-md-2 col-sm-2 box0">
                                    <div class="box1">
                                        <span class="li_cloud"></span>
                                        <h3>+48</h3>
                                    </div>
                                        <p>48 New files were added in your cloud storage.</p>
                                </div>
                                <div class="col-md-2 col-sm-2 box0">
                                    <div class="box1">
                                        <span class="li_stack"></span>
                                        <h3>23</h3>
                                    </div>
                                        <p>You have 23 unread messages in your inbox.</p>
                                </div>
                                <div class="col-md-2 col-sm-2 box0">
                                    <div class="box1">
                                        <span class="li_news"></span>
                                        <h3>+10</h3>
                                    </div>
                                        <p>More than 10 news were added in your reader.</p>
                                </div>
                                <div class="col-md-2 col-sm-2 box0">
                                    <div class="box1">
                                        <span class="li_data"></span>
                                        <h3>OK!</h3>
                                    </div>
                                        <p>Your server is working perfectly. Relax & enjoy.</p>
                                </div>
                            </div><!--row mt -->
                            <!--<hr/> -->

                            {% comment %} ****************************************
                                                BLOG MODULE 
                            **************************************** {% endcomment %}

                            {% comment %} posts div starts {% endcomment %}
                            
                            <div class="row" style="overflow: hidden;">
                                <div class="post-div col-md-12 col-sm-12 mb" id="post-id-{{ post.id }}" style="font-size: 16px;">
                                    <div class="panel panel-info " style="overflow: hidden;">
                                        <input type="hidden" name="id" value="{{ post.id }}">
                                        <div class="panel-heading">
                                            <h3 id="post-title">{{ post.title | title }}</h3>
                                            {% if request.user.first_name == post.author.first_name and request.user.last_name == post.author.last_name %}
                                            <div class="post-actions" style="border-top-right-radius: 3px; background-color: rgba(0,0,0,.5); display:none; position: absolute; top: 0px; right: 15px; padding: 7px;">
                                                <i onclick="update_post({{ post.id }})" data-backdrop="false" data-toggle="modal" data-target="#updateModal" style="color: #ffffff; margin-right: 7px; transform:scale(1.3,1.3);cursor:pointer" class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                                <i onclick="delete_post({{ post.id }})" data-backdrop="false" data-toggle="modal" data-target="#deleteModal" style="color: #ffffff; transform:scale(1.3,1.3);cursor:pointer" class="glyphicon glyphicon-remove"></i>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-md-4 col-lg-4 col-sm-4">
                                                    Category: <h5 style="display: inline;"><a href="{% url 'social:category' post.category %}">{{ post.category | title }}</a></h5>
                                                </div>
                                                <div class="col-md-4 col-lg-4 col-sm-4">
                                                    Subcategory: <h5 style="display: inline;">{{ post.subcategory | title }}</h5>
                                                </div>
                                                <div class="col-md-4 col-lg-4 col-sm-4" style="text-align: right;">
                                                    <strong id="post-author">
                                                            <a href="{% url 'social:friend-profile' post.author.first_name post.author.last_name post.author.pk %}">
                                                                {{ post.author.first_name | title }} {{ post.author.last_name | title }}</strong>
                                                            </a> :
                                                        <span id="post-published">
                                                        {% check_timestamp post.published_date|timesince as timestamp %}
                                                        {% if timestamp == 'just now'%}
                                                            <small>just now</small>
                                                        {% else %}
                                                            <small>{{ post.published_date|timesince }} ago</small>
                                                        {% endif %}
                                                            
                                                        </span>
                                                </div>
                                            </div>
                                            <hr style="border-top: 1px solid #797979;margin-top:10px;margin-bottom:10px;">
                                            <p id="post-text" style="word-break: break-all; white-space: pre-wrap;">
                                                {{ post.text|title|linebreaks  }}
                                            </p>
                                        </div>
                                        <div class="panel-heading" style="overflow: hidden;">
                                            <ul class="dlikes list-group" >
                                                {% get_like_obj post.id request.user.id as like_obj %}
                                                {% get_dislike_obj post.id request.user.id as dislike_obj %}
                                                {% comment %} {% if dislike_obj == False%} {% endcomment %}
                                                    {% if like_obj %}
                                                    <li class="list-group-item">
                                                        <i onclick="undolike({{ post.id }})" style="transform:scale(1.5,1.5); cursor:pointer;" class="undolike likedislikeclass glyphicon glyphicon-thumbs-up" aria-hidden="true"></i>
                                                    </li>
                                                    {% else %}
                                                        <li class="list-group-item">
                                                            <i onclick="like({{ post.id }})" style="transform:scale(1.5,1.5);cursor:pointer;" class="like glyphicon glyphicon-thumbs-up" aria-hidden="true"></i>
                                                        </li>
                                                    {% endif %}    

                                                    {% if post.likes.count > 0 %}    
                                                        <li class="list-group-item">
                                                            <strong id="like-count">{{ post.likes.count }}</strong>
                                                        </li>
                                                    {% else %}
                                                        <li class="list-group-item">
                                                            <strong id="like-count"></strong>
                                                        </li>
                                                    {% endif %}   
                                                {% comment %} {% endif %}  {% endcomment %}

                                                {% if dislike_obj %}
                                                <li class="list-group-item">
                                                    <i onclick="undodislike({{ post.id }})" style="transform:scale(1.5,1.5); cursor:pointer;" class="undodislike likedislikeclass glyphicon glyphicon-thumbs-down" aria-hidden="true"></i>
                                                </li>
                                                {% else %}
                                                    <li class="list-group-item">
                                                        <i onclick="dislike({{ post.id }})" style="transform:scale(1.5,1.5);cursor:pointer;" class="dislike glyphicon glyphicon-thumbs-down" aria-hidden="true"></i>
                                                    </li>
                                                {% endif %}    

                                                {% if post.dislikes.count > 0 %}    
                                                    <li class="list-group-item">
                                                        <strong id="dislike-count">{{ post.dislikes.count }}</strong>
                                                    </li>
                                                {% else %}
                                                    <li class="list-group-item">
                                                        <strong id="dislike-count"></strong>
                                                    </li>
                                                {% endif %}    

                                                <li class="list-group-item comment-icon">
                                                    <i style="transform:scale(1.5,1.5); cursor:pointer;" class="fa fa-comment" aria-hidden="true"></i>
                                                </li>
                                                
                                                {% if post.comment_set.count > 0 %}    
                                                    <li class="list-group-item">
                                                        <strong id="comment-count">{{ post.comment_set.count }}</strong>
                                                    </li>
                                                {% else %}
                                                    <li class="list-group-item">
                                                        <strong id="comment-count"></strong>
                                                    </li>
                                                {% endif %}    
                                            </ul>
                                            <!--comment and replies start-->
                                                <div class="comment-reply-banner">
                                                    <div class="comment-header mb-10" style="overflow: hidden;">
                                                        <h5 class="comment-plus inline">
                                                            {% if post.comment_set.all %}
                                                                <span class="comment-sum"><span class="comment-count">{{ post.comment_set.count }}</span> &nbsp;Comment{{ post.comment_set.count|pluralize:"s" }}</span>
                                                                {% else %}
                                                                    <span class="be-the-first-commenter">Be the first to comment</span>
                                                            {% endif %}
                                                        </h5>
                                                        <i class="fa fa-plus add-comment pointer" aria-hidden="true"></i>
                                                    </div>
                                                    <div class="comment-form-wrapper row mb-10" style="">
                                                        <form id="comment-form-{{ post.id }}" name="comment-form" method="post">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="post-id" value="{{ post.id }}">
                                                            <div class="col-xs-12 col-sm-12 col-md-12 " style="">
                                                                <textarea maxlength="1024" name="comment-textarea" style="" class="form-control" placeholder="Comment here..."></textarea>
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="comment-banner" style=''>
                                                        {% get_comments post.comment_set.all as ordered_comments %}
                                                        {% for comment in ordered_comments %}
                                                            {% newer comment.commented_at|timesince as newer_comment %}
                                                            <div class="comment-reply-wrapper" id="comment-id-{{ comment.id }}" style=" {% if newer_comment %}margin-bottom: 15px; box-shadow: 1px 1px 10px #c2c2c2; {% endif %}">
                                                                <div class="comment-actions">
                                                                    <ul style="margin-bottom: 0px;">
                                                                        <li> 
                                                                            <h5 class="commenter" style="display: inline">
                                                                                <a href="{% url 'social:friend-profile' comment.user.first_name comment.user.last_name comment.user.pk %}">
                                                                                    {{ comment.user.first_name|title }} {{ comment.user.last_name|title }}
                                                                                </a>
                                                                            </h5>
                                                                        </li>
                                                                        <li>
                                                                            <em><small class="comment-quote">commented</small></em> 
                                                                        </li>
                                                                        <li class="comment-timestamp restrict-select">
                                                                            <em style="font-size: 12px;">
                                                                            {% check_timestamp comment.commented_at|timesince as timestamp %}
                                                                                {% if timestamp == 'just now' %}
                                                                                    just now
                                                                                    {% else %}
                                                                                    {{ timestamp }}
                                                                                    <small> ago</small>
                                                                                {% endif %}
                                                                            </em>
                                                                        </li>
                                                                        <li class="reply-or-replies pointer comment-actions">
                                                                            {% if comment.reply_set.count %}
                                                                                Replies
                                                                                {% else %}
                                                                                <i class="fa fa-reply" aria-hidden="true"></i>
                                                                            {% endif %}
                                                                        </li>
                                                                            {% if post.author == request.user or request.user == comment.user %}
                                                                            <li class="delete-comment pointer comment-actions">
                                                                                <i class="fa fa-trash" aria-hidden="true"></i>
                                                                            </li>
                                                                        {% endif %}
                                                                    </ul>
                                                                </div>
                                                                <div class="comment-message-container" style="">
                                                                    <span class="comment-message" style="">{{ comment.message}}</span>
                                                                    {% if post.author == request.user or request.user == comment.user %}
                                                                        <i class="glyphicon glyphicon-pencil edit-comment pointer" style="font-size: 14px; color: #31708f; vertical-align: middle; padding: 5px;" aria-hidden="true"></i>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="reply-form-wrapper row mb-10" style="">
                                                                    <form name="reply-form" method="post">
                                                                        {% csrf_token %}
                                                                        <input type="hidden" name="comment-id" value="{{ comment.id }}">
                                                                        <div class="col-xs-12 col-sm-12 col-md-12 " style="">
                                                                            <textarea maxlength="1024" name="reply-textarea" style="border-top-right-radius: 0px; resize: none;" class="form-control" placeholder="Reply here..."></textarea>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                                <div class="reply-container" style="overflow: hidden; display: none; margin-left: 20px;">
                                                                    <div class="reply-header mb-10" style="overflow: hidden;">
                                                                        <h5 class="reply-plus inline">
                                                                            {% if comment.reply_set.all %}
                                                                                <span class="reply-sum"><span class="reply-count">{{ comment.reply_set.count }}</span> &nbsp;Repl{{ comment.reply_set.count|pluralize:"y,ies" }}</span>
                                                                                {% else %}
                                                                                    <span class="be-the-first-replier">Be the first to reply</span>
                                                                            {% endif %}
                                                                        </h5>
                                                                        <i class="fa fa-plus add-reply pointer" aria-hidden="true"></i>
                                                                    </div>
                                                                    {% get_replies comment.reply_set.all as ordered_replies %}
                                                                    {% for reply in ordered_replies %}
                                                                    {% newer reply.replied_at|timesince as newer_reply %}
                                                                        <div class="reply-wrapper" id="reply-id-{{ reply.id }}" style="{% if newer_reply %} box-shadow: 1px 1px 10px #c2c2c2; margin-bottom: 15px;{% endif %}">
                                                                            <input type="hidden" name="reply-id" value="{{ reply.id }}">
                                                                            <div class="reply-actions">
                                                                                <ul style="margin-bottom: 0px; overflow: hidden">
                                                                                    <li> 
                                                                                        <h5 class="replier" style="display: inline">
                                                                                            <a href="{% url 'social:friend-profile' reply.user.first_name reply.user.last_name reply.user.pk %}">
                                                                                                {{ reply.user.first_name|title }} {{ reply.user.last_name|title }}
                                                                                            </a>
                                                                                        </h5>
                                                                                    </li>
                                                                                    <li>
                                                                                        <em><small class="reply-quote">replied</small></em> 
                                                                                    </li>
                                                                                    <li class="reply-timestamp restrict-select">
                                                                                        <em style="font-size: 12px;">
                                                                                            {% check_timestamp reply.replied_at|timesince as timestamp %}
                                                                                            {% if timestamp == 'just now' %}
                                                                                                just now
                                                                                                {% else %}
                                                                                                {{ timestamp }}
                                                                                                <small> ago</small>
                                                                                            {% endif %}
                                                                                        </em>
                                                                                    </li>
                                                                                    {% if request.user == reply.user or request.user == comment.user or request.user == post.author %}
                                                                                        <li class="delete-reply pointer">
                                                                                            <i class="fa fa-trash" aria-hidden="true"></i>
                                                                                        </li>
                                                                                    {% endif %}
                                                                                </ul>
                                                                            </div>
                                                                            <div class="reply-message-container" style="">
                                                                                <span class="reply-message" style="padding: 5px 10px; white-space: normal; color: #31708f;  ">{{ reply.message}}</span>
                                                                                {% if post.author == request.user or request.user == comment.user or request.user == reply.user %}
                                                                                    <i class="glyphicon glyphicon-pencil edit-reply pointer" style="color: #31708f; font-size: 14px; vertical-align: middle; padding: 5px;" aria-hidden="true"></i>
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                    {% endfor %}
                                                                    {% if comment.reply_set.count > 1 %}
                                                                        <div style="overflow: hidden; padding-bottom: 10px;">
                                                                            <span class="pointer expand-replies">Show all replies</span>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                            </div>    
                                                        {% endfor %}
                                                        {% if post.comment_set.count > 1 %}
                                                            <div style="overflow: hidden;">
                                                                <span class="pointer expand-comments" style="">Show all comments</span>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                
                                            <!--comment and replies end-->
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                        
                            {% if invalid_or_unavailable_category %}
                                    <div class="row" style="overflow: hidden;">
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <h3 class="text-center">:(</h3>
                                            <h6 class="text-center">No blogs so far !</h6>
                                        </div>
                                    </div>
                            {% endif %}
                            {% comment %} posts ends here {% endcomment %}

                            {% comment %} pagination starts {% endcomment %}
                            {% if posts and num_posts >= 5 %}
                                <div class="row">
                                    <div class="col-md-10 col-lg-10 text-center">
                                        <nav aria-label="..." class="">
                                            <ul class="pagination">
                                                {% if posts.has_previous %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=1">First</a>
                                                </li>
                                                <li class="page-item"><a class="page-link" href="?page={{ posts.previous_page_number }}">{{ posts.previous_page_number }}</a></li>
                                                {% endif %}
                                                <li class="page-item active">
                                                <a class="page-link" href="?page={{ posts.number }}">{{ posts.number }} <span class="sr-only">(current)</span></a>
                                                </li>
                                                
                                                {% if posts.has_next %}
                                                    <li class="page-item">
                                                        <a class="page-link" href="?page={{ posts.next_page_number }}">{{ posts.next_page_number }}</a>
                                                    </li>
                                                    <li class="page-item">
                                                        <a class="page-link" href="?page={{ total_pages }}">Last</a>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            {% endif %}
                            {% comment %} pagination ends {% endcomment %}
                            
                        </div><!-- /col-md-4 -->

                        <!--<div class="col-md-4 mb">-->
                            <!--&lt;!&ndash; WHITE PANEL - TOP USER &ndash;&gt;-->
                            <!--<div class="white-panel pn">-->
                                <!--<div class="white-header">-->
                                    <!--<h5>TOP USER</h5>-->
                                <!--</div>-->
                                <!--<p><img src="assets/img/ui-zac.jpg" class="img-circle" width="80"></p>-->
                                <!--<p><b>Zac Snider</b></p>-->
                                <!--<div class="row">-->
                                    <!--<div class="col-md-6">-->
                                        <!--<p class="small mt">MEMBER SINCE</p>-->
                                        <!--<p>2012</p>-->
                                    <!--</div>-->
                                    <!--<div class="col-md-6">-->
                                        <!--<p class="small mt">TOTAL SPEND</p>-->
                                        <!--<p>$ 47,60</p>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>&lt;!&ndash; /col-md-4 &ndash;&gt;-->


                    </div><!-- /row -->

                    <div class="row mt">
                        <!--CUSTOM CHART START -->
                        <div class="border-head">
                            <h3>VISITS</h3>
                        </div>
                        <div class="custom-bar-chart">
                            <ul class="y-axis">
                                <li><span>10.000</span></li>
                                <li><span>8.000</span></li>
                                <li><span>6.000</span></li>
                                <li><span>4.000</span></li>
                                <li><span>2.000</span></li>
                                <li><span>0</span></li>
                            </ul>
                            <div class="bar">
                                <div class="title">JAN</div>
                                <div class="value tooltips" data-original-title="8.500" data-toggle="tooltip" data-placement="top">85%</div>
                            </div>
                            <div class="bar ">
                                <div class="title">FEB</div>
                                <div class="value tooltips" data-original-title="5.000" data-toggle="tooltip" data-placement="top">50%</div>
                            </div>
                            <div class="bar ">
                                <div class="title">MAR</div>
                                <div class="value tooltips" data-original-title="6.000" data-toggle="tooltip" data-placement="top">60%</div>
                            </div>
                            <div class="bar ">
                                <div class="title">APR</div>
                                <div class="value tooltips" data-original-title="4.500" data-toggle="tooltip" data-placement="top">45%</div>
                            </div>
                            <div class="bar">
                                <div class="title">MAY</div>
                                <div class="value tooltips" data-original-title="3.200" data-toggle="tooltip" data-placement="top">32%</div>
                            </div>
                            <div class="bar ">
                                <div class="title">JUN</div>
                                <div class="value tooltips" data-original-title="6.200" data-toggle="tooltip" data-placement="top">62%</div>
                            </div>
                            <div class="bar">
                                <div class="title">JUL</div>
                                <div class="value tooltips" data-original-title="7.500" data-toggle="tooltip" data-placement="top">75%</div>
                            </div>
                        </div>
                        <!--custom chart end-->
                    </div><!-- /row -->

                </div><!-- /col-lg-9 END SECTION MIDDLE -->

                <!-- **********************************************************************************************************************************************************
                RIGHT SIDEBAR CONTENT
                *********************************************************************************************************************************************************** -->

                <div class="col-lg-3 ds">
                <!--COMPLETED ACTIONS DONUTS CHART-->
                    <h3>NOTIFICATIONS</h3>

                    <!-- First Action -->
                    <div class="desc">
                    <div class="thumb">
                        <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                    </div>
                    <div class="details">
                        <p><muted>2 Minutes Ago</muted><br/>
                            <a href="#">James Brown</a> subscribed to your newsletter.<br/>
                        </p>
                    </div>
                    </div>
                    <!-- Second Action -->
                    <div class="desc">
                    <div class="thumb">
                        <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                    </div>
                    <div class="details">
                        <p><muted>3 Hours Ago</muted><br/>
                            <a href="#">Diana Kennedy</a> purchased a year subscription.<br/>
                        </p>
                    </div>
                    </div>
                    <!-- Third Action -->
                    <div class="desc">
                    <div class="thumb">
                        <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                    </div>
                    <div class="details">
                        <p><muted>7 Hours Ago</muted><br/>
                            <a href="#">Brandon Page</a> purchased a year subscription.<br/>
                        </p>
                    </div>
                    </div>
                    <!-- Fourth Action -->
                    <div class="desc">
                    <div class="thumb">
                        <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                    </div>
                    <div class="details">
                        <p><muted>11 Hours Ago</muted><br/>
                            <a href="#">Mark Twain</a> commented your post.<br/>
                        </p>
                    </div>
                    </div>
                    <!-- Fifth Action -->
                    <div class="desc">
                    <div class="thumb">
                        <span class="badge bg-theme"><i class="fa fa-clock-o"></i></span>
                    </div>
                    <div class="details">
                        <p><muted>18 Hours Ago</muted><br/>
                            <a href="#">Daniel Pratt</a> purchased a wallet in your store.<br/>
                        </p>
                    </div>
                    </div>

                    <!-- USERS ONLINE SECTION -->
                    <h3>TEAM MEMBERS</h3>
                    <!-- First Member -->
                    <div class="desc">
                    <div class="thumb">
                        <img class="img-circle" src="assets/img/ui-divya.jpg" width="35px" height="35px" align="">
                    </div>
                    <div class="details">
                        <p><a href="#">DIVYA MANIAN</a><br/>
                            <muted>Available</muted>
                        </p>
                    </div>
                    </div>
                    <!-- Second Member -->
                    <div class="desc">
                    <div class="thumb">
                        <img class="img-circle" src="assets/img/ui-sherman.jpg" width="35px" height="35px" align="">
                    </div>
                    <div class="details">
                        <p><a href="#">DJ SHERMAN</a><br/>
                            <muted>I am Busy</muted>
                        </p>
                    </div>
                    </div>
                    <!-- Third Member -->
                    <div class="desc">
                    <div class="thumb">
                        <img class="img-circle" src="assets/img/ui-danro.jpg" width="35px" height="35px" align="">
                    </div>
                    <div class="details">
                        <p><a href="#">DAN ROGERS</a><br/>
                            <muted>Available</muted>
                        </p>
                    </div>
                    </div>
                    <!-- Fourth Member -->
                    <div class="desc">
                    <div class="thumb">
                        <img class="img-circle" src="assets/img/ui-zac.jpg" width="35px" height="35px" align="">
                    </div>
                    <div class="details">
                        <p><a href="#">Zac Sniders</a><br/>
                            <muted>Available</muted>
                        </p>
                    </div>
                    </div>
                    <!-- Fifth Member -->
                    <div class="desc">
                    <div class="thumb">
                        <img class="img-circle" src="assets/img/ui-sam.jpg" width="35px" height="35px" align="">
                    </div>
                    <div class="details">
                        <p><a href="#">Marcel Newman</a><br/>
                            <muted>Available</muted>
                        </p>
                    </div>
                    </div>

                    <!-- CALENDAR-->
                    <div id="calendar" class="mb">
                        <div class="panel green-panel no-margin">
                            <div class="panel-body">
                                <div id="date-popover" class="popover top" style="cursor: pointer; disadding: block; margin-left: 33%; margin-top: -50px; width: 175px;">
                                    <div class="arrow"></div>
                                    <h3 class="popover-title" style="disadding: none;"></h3>
                                    <div id="date-popover-content" class="popover-content"></div>
                                </div>
                                <div id="my-calendar"></div>
                            </div>
                        </div>
                    </div><!-- / calendar -->

                </div><!-- /col-lg-3 -->
            </div><!--/row -->
        </section>
    </section>

    <!--main content end-->

<!--modals-->

<!--delete prompt modal-->
    <div class="modal fade" id="deletepromptmodal" tabindex="-1" role="dialog" aria-labelledby="deletepromptmodalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="border: solid 1px red; border-top-left-radius: 0px; border-top-right-radius: 0px;">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
            <h4 class="modal-title" id="deletepromptmodalLabel">Do you really want to DELETE?</h4>
        </div>
        <div class="modal-body">
            <p id="delete_title"></p>
        <div class="modal-footer">
            <button type="button" id="delete_confirm" class="btn btn-danger" >DELETE</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
        </div>
        </div>
    </div>
    </div>

<!--deletion message modal-->
<div class="modal fade" id="delete_message" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
        <button type="button" style="position:absolute; right:10px; top:10px;" class="close" data-dismiss="modal" aria-label="Close">x</button>
        <div class="modal-body">
        <p class="text-center">Post has been <span class="text-danger">DELETED</span> successfully!</p>
        </div>
    </div>
    </div>
</div>


<!--updation message modal-->
<div class="modal fade" id="update_message" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
        <button type="button" style="position:absolute; right:10px; top:10px;" class="close" data-dismiss="modal" aria-label="Close">x</button>
        <div class="modal-body">
        <p class="text-center">Post has been <span class="text-info">UPDATED</span> successfully!</p>
        </div>
    </div>
    </div>
</div>


<!--update modal-->
<div class="modal fade" id="updateModal" tabindex="-1" role="dialog"  aria-labelledby="updateModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                <h4 class="modal-title" id="updateModalLabel">Post details</h4>
            </div>
            <div class="modal-body">
                <form class="post-update-form" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <p><input type="text" id="update-post-title" class="form-control" placeholder="Post Title"></p>
                        <p><textarea style="resize:none;" id="update-post-content" class="form-control" rows="3" placeholder="What's on your mind!"></textarea></p>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" >Save changes</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block custom_scripts %}
<script type="application/javascript">
    $(document).ready(function () {
        $("#date-popover").popover({html: true, trigger: "manual"});
        $("#date-popover").hide();
        $("#date-popover").click(function (e) {
            $(this).hide();
        });

        $("#my-calendar").zabuto_calendar({
            action: function () {
                return myDateFunction(this.id, false);
            },
            action_nav: function () {
                return myNavFunction(this.id);
            },
            ajax: {
                url: "show_data.php?action=1",
                modal: true
            },
            legend: [
                {type: "text", label: "Special event", badge: "00"},
                {type: "block", label: "Regular event", }
            ]
        });
    });


    function myNavFunction(id) {
        $("#date-popover").hide();
        var nav = $("#" + id).data("navigation");
        var to = $("#" + id).data("to");
        console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
    }
</script>

<script type="application/javascript">
    // dynamically adding subcategories to category
    $('select[name="category"]').change(function(){
        $.ajax({
                url: "{% url 'social:add-subcategory' %}",
                type: "GET",
                data: {
                    'category': $(this).val().trim()
                },
                success: function(data){
                    console.log(data);
                    var html = "";
                    $.each(data.subcategories, function (key, value) {
                        html += "<option value='" + value + "'>" + value + "</option>";
                    });
                    $('select[name="subcategory"]').html('<option value="None">Select Subcategory</option>' + html);
                },
                error: function(data){
                    console.log(data);
                }
            });
    });

    // toggling post add button
    $(document).on('click', '.add-blog', function(){
        $('.add-category').removeClass('rotate-plus');
        $(this).toggleClass('rotate-plus');
        $(this).attr('title', '');
        $('.create-category').slideUp();
        $(".post-create-form").slideToggle();
    })

    // toggling category add button
    $(document).on('click', '.add-category', function(){
        $('.add-blog').removeClass('rotate-plus');
        $(this).toggleClass('rotate-plus');
        $(this).attr('title', '');
        $('.post-create-form').slideUp();
        $(".create-category").slideToggle();
    })

    $(".post-div").mouseenter(function(){
        $(this).find(".posts-actions").fadeOut();
    })




</script>

<script type="application/javascript">

    /* ****************************************
                    POST MODULE 
    **************************************** */


    // removing comments
    $(document).on('click', '.delete-comment', function(){
        var comment_id = $(this).parents('.comment-reply-wrapper').find('[name="comment-id"]').val();
        var post_id = $(this).parents('.comment-reply-banner').find('[name="post-id"]').val();
        var comments = $(this).parents('.comment-reply-banner').find('.comment-reply-wrapper');
        $.ajax({
            url: "{% url 'social:remove-comment' %}",
            type: "POST",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'comment_id': comment_id,
                'post_id': post_id,
            },
            success: function(data){
                if (data.total_comments == 0){
                    $('#post-id-' + post_id).find('.comment-plus').html('<span class="be-the-first-commenter">Be the first to comment</span>');
                    $('#post-id-' + post_id).find('.expand-comments').parent().remove();
                    $('#post-id-' + post_id).find('#comment-count').text('');
                }
                else if(data.total_comments == 1){
                    $('#post-id-' + post_id).find('.expand-comments').parent().remove();
                    $('#post-id-' + post_id).find('.comment-count').text(data.total_comments);
                    $('#post-id-' + post_id).find('#comment-count').text(data.total_comments);
                    $('#post-id-' + post_id).find('.comment-plus').html('<span class="comment-sum"><span class="comment-count">' + data.total_comments +  '</span> &nbsp;Comment</span>');

                }
                else{
                    $('#post-id-' + post_id).find('.comment-count').text(data.total_comments);
                    $('#post-id-' + post_id).find('#comment-count').text(data.total_comments);
                }
                if (data.total_comments <= 5){
                    $("#post-id-" + post_id).find('.comment-reply-banner').css({
                        'height': 'unset',
                        'overflow': 'hidden',
                    });    
                }else{
                    $("#post-id-" + post_id).find('.comment-reply-banner').css({
                        'height': '400px',
                        'overflow': 'auto',
                    });
                }
                comments.slice().show();
                $("#post-id-" + post_id).find('.expand-comments').text('Show less');
                $('#comment-id-' + comment_id).remove();
            },
        });
          
    })
    

    // removing reply
    $(document).on('click', '.delete-reply', function(){
        var post_id = $(this).parents('.comment-reply-banner').find('[name="post-id"]').val();
        var comment_id = $(this).parents('.comment-reply-banner').find('[name="comment-id"]').val();
        var reply_id = $(this).parents('.comment-reply-wrapper').find('[name="reply-id"]').val();
        var replies = $(this).parents('.comment-reply-wrapper').find('.reply-container').children('.reply-wrapper');
        console.log(post_id,comment_id, reply_id);
        $.ajax({
            url: "{% url 'social:remove-reply' %}",
            type: "POST",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'post_id': post_id,
                'comment_id': comment_id,
                'reply_id': reply_id,
            },
            success: function(data){
                if (data.total_replies == 0){
                    $('#comment-id-' + comment_id).find('.reply-plus').html('<span class="be-the-first-replier">Be the first to reply</span>');
                    $('#comment-id-' + comment_id).find('.expand-replies').parent().remove();
                }
                else if(data.total_replies == 1){
                    $('#comment-id-' + comment_id).find('.expand-replies').parent().remove();
                    $('#comment-id-' + comment_id).find('.reply-count').text(data.total_replies);
                    $('#comment-id-' + comment_id).find('.reply-plus').html('<span class="reply-sum"><span class="reply-count">' + data.total_replies +  '</span> &nbsp;Reply</span>');
                    
                }
                else{
                    $('#comment-id-' + comment_id).find('.reply-count').text(data.total_replies);
                }
                if (data.total_replies <= 5){
                    $('#comment-id-' + comment_id).find('.reply-container').css({
                        'height': 'unset',
                        'overflow': 'hidden',
                    });    
                }else{
                    $('#comment-id-' + comment_id).find('.reply-container').css({
                        'height': '400px',
                        'overflow': 'auto',
                    });
                }
                replies.slice().show();
                $('#comment-id-' + comment_id).find('.expand-replies').text('Show less');
                $('#reply-id-' + reply_id).remove();
            },
        });
        return false;
          
    })


    // show/hide post comment's reply panel
    $(document).on('click', 'button[name="show-replies"]', function(){
        if ($(this).text().trim() == 'Hide replies'){
        $('.reply-div').slideUp();
        $(this).text('show-replies');
        }else{
            $('.reply-div').slideUp();
            $(this).parent().find('.reply-div').slideDown();
            $('button[name="show-replies"]').text("show-replies");
            $(this).text('Hide replies');
        }
    });


    // replying comments
        function add_reply_to_page(comment_id, data){
            $('#comment-id-' + comment_id).find('.reply-container').find('.reply-header').after(`
                <div class="reply-wrapper" id="reply-id-${data.reply_id}" style="overflow: hidden; width: 90%; margin-left: 10px; padding: 10px 15px 0px 15px; margin-bottom: 15px; box-shadow: 1px 1px 10px #c2c2c2;">
                    <input type="hidden" name="reply-id" value="${data.reply_id}">
                    <div class="reply-actions">
                        <ul style="margin-bottom: 0px; overflow: hidden">
                            <li> 
                                <h5 class="replier" style="display: inline">
                                    <a href="/${data.reply_user_fname}/${data.reply_user_lname}/${data.replier_id}">
                                        ${data.reply_user_fname} ${data.reply_user_lname}
                                    </a>
                                </h5>
                            </li>
                            <li>
                                <em><small class="reply-quote">replied</small></em> 
                            </li>
                            <li class="reply-timestamp restrict-select">
                                <em style="font-size: 12px;">
                                    just now
                                </em>
                            </li>
                            <li class="delete-reply pointer">
                                <i class="fa fa-trash" aria-hidden="true"></i>
                            </li>
                        </ul>
                    </div>
                    <div class="reply-message-container" style="word-wrap: break-word; width: 95%; display: inline-block; margin-left: 15px; border-radius: 25px; overflow: hidden; padding: 10px;">
                        <span class="reply-message" style="padding: 5px 10px; white-space: normal; color: #31708f;  ">${data.reply_message}</span>
                        <i class="glyphicon glyphicon-pencil edit-reply pointer" style="font-size: 14px; vertical-align: middle; padding: 5px; color: #31708f;" aria-hidden="true"></i>
                    </div>
                </div>
            `);
            if (data.total_replies == 2){
                $('.reply-container').append(`
                    <div style="overflow: hidden; margin-bottom: 5px;">
                        <span class="pointer expand-replies" style="">Show less</span>
                    </div>
                `);
            }
            if (data.total_replies > 5){
                $('.expand-replies').text('Show all replies');
                $('.expand-replies').trigger('click');
            }
            var replies = $("#comment-id-" + comment_id).find('.reply-container').children('.reply-wrapper');
            replies.slice(0,1).show();
        }

        
        $(document).on('keydown', '[name="reply-textarea"]', function(event){
            if (event.which === 32 && !$(this).val().length){
                event.preventDefault();
            }
            if (event.which === 13){
                if ($(this).val().length){
                    $('[name="reply-form"]').trigger('submit');
                    return false;
                }else{
                    event.preventDefault();
                }
                
            }
        });
            

        $(document).on('submit', '[name="reply-form"]', function(event){
            event.preventDefault();
            var comment_id = $(this).find('[name="comment-id"]').val();
            var reply_message = $(this).find('[name="reply-textarea"]').val().trim();
            if (!reply_message){
                return false;
            }else{
                $.ajax({
                    url: "{% url 'social:reply-to-comment' %}",
                    type: "POST",
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'comment_id': comment_id,
                        'reply': reply_message,
                    },
                    success: function(data){
                        add_reply_to_page(comment_id, data);
                        if (data.total_replies == 1 ){
                            $('#comment-id-' + comment_id).find('.reply-plus').html('<span class="reply-sum"><span class="reply-count">1</span> Reply</span>');
                        }else{
                            $('#comment-id-' + comment_id).find('.reply-plus').html('<span class="reply-sum"><span class="reply-count">' + data.total_replies + '</span> Replies</span>');
                        }
                    },
                    error: function(data){
                        console.log(data);
                    },
                    complete: function(data){
                    }
                });
            }
            $(this).trigger('reset');
            $(this).parent('.reply-form-wrapper').slideUp();
            return false;
        });


    // commenting post
        function add_comment_to_page(id, data){
            //$("#post-id-" + id).find(".comment-count").text(data.total_comments);
            $('#post-id-' + id).find('#comment-count').text(data.total_comments);
            $("#post-id-" + id).find(".comment-banner").prepend(`
                <div class="comment-reply-wrapper" id="comment-id-${data.comment_id}" style="border: 1px solid rgb(204, 204, 204);box-shadow: 1px 1px 10px #c2c2c2; padding: 5px 15px 0px 15px; margin-bottom: 15px;">
                    <div class="comment-actions">
                        <ul style="margin-bottom: 0px;">
                            <li> 
                                <h5 class="commenter" style="display: inline">
                                    <a href="/${data.comment_user_fname}/${data.comment_user_lname}/${data.commentor_id}">
                                        ${data.comment_user_fname} ${data.comment_user_lname}
                                    </a>
                                </h5>
                            </li>
                            <li>
                                <em><small class="comment-quote">commented</small></em> 
                            </li>
                            <li class="comment-timestamp restrict-select">
                                <em style="font-size: 12px;">jus now
                                </em>
                            </li>
                            <li class="reply-or-replies pointer">
                                {% if comment.reply_set.count %}
                                    Replies
                                    {% else %}
                                    <i class="fa fa-reply" aria-hidden="true"></i>
                                {% endif %}
                            </li>
                                <li class="delete-comment pointer">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                </li>
                        </ul>
                    </div>
                    <div class="comment-message-container" style="overflow: hidden; width: 95%; border-radius: 25px; word-wrap: break-word; display: inline-block; margin-left: 20px; padding: 10px;">
                        <span class="comment-message" style="white-space: normal; padding: 5px 10px; color: #31708f;">${data.comment_message}</span>
                        <i class="glyphicon glyphicon-pencil edit-comment pointer" style="font-size: 14px; color: #31708f; vertical-align: middle; padding: 5px;" aria-hidden="true"></i>
                    </div>
                    <div class="reply-form-wrapper row mb-10" style="display: none; overflow: hidden; box-sizing: border-box; margin-left: 20px; margin-bottom: 10px;">
                        <form name="reply-form" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="comment-id" value="${data.comment_id}">
                            <div class="col-xs-12 col-sm-12 col-md-12 " style="">
                                <textarea maxlength="1024" name="reply-textarea" style="border-top-right-radius: 0px; resize: none;" class="form-control" placeholder="Reply here..."></textarea>
                            </div>
                            
                        </form>
                    </div>
                    <div class="reply-container" style="overflow: hidden; display: none; margin-left: 20px;">
                        <div class="reply-header mb-10" style="overflow: hidden;">
                            <h5 class="reply-plus inline">
                                Be the first to reply
                            </h5>
                            <i class="fa fa-plus add-reply pointer" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>    
            `);
            if (data.total_comments == 2){
                $('.comment-banner').append(`
                    <div style="overflow: hidden;">
                        <span class="pointer expand-comments" style="">Show less</span>
                    </div>
                `);
            }
            if (data.total_comments > 5){
                $('.expand-comments').text('Show all commnets');
                $('.expand-comments').trigger('click');
            }
            
            var comments = $("#post-id-" + id).find('.comment-banner').children('.comment-reply-wrapper');
            comments.slice(0,1).show();
        }


        $('[name="comment-textarea"]').keydown(function(event){
            if (event.which === 32 && !$(this).val().length){
                event.preventDefault();
            }
            if (event.which === 13){
                if ($(this).val().length){
                    $('[name="comment-form"]').trigger('submit');
                    return false;
                }else{
                    event.preventDefault();
                }
                
            }
        })

        $('[name="comment-form"]').submit(function(event){
                event.preventDefault();
                var post_id = $(this).find('[name="post-id"]').val();
                var comment_message = $(this).find('[name="comment-textarea"]').val().trim();
                var csrfmiddlewaretoken = $(this).find('[name="csrfmiddlewaretoken"]').val().trim();
                if (!comment_message){
                    return false;
                }else{
                    $.ajax({
                        url: "{% url 'social:comment' %}",
                        type: "POST",
                        data: {
                            'csrfmiddlewaretoken': csrfmiddlewaretoken,
                            'post_id': post_id,
                            'comment': comment_message,
                        },
                        success: function(data){
                            console.log('commented OK');
                            add_comment_to_page(post_id, data);
                            if (data.total_comments == 1 ){
                                $('#post-id-' + post_id).find('.comment-plus').html('<span class="comment-sum"><span class="comment-count">1</span> Comment</span>');
                            }else{
                                $('#post-id-' + post_id).find('.comment-plus').html('<span class="comment-sum"><span class="comment-count">' + data.total_comments + '</span> Comments</span>');
                            }  
                            
                        },
                        error: function(data){
                            console.log(data);
                        },
                        complete: function(data){
                        }
                    });
                }
                $(this).trigger('reset');
                $(this).parent('.comment-form-wrapper').slideUp();
                return false;
            });




    // post deletion
    function delete_post(id){
        var title = $("#post-id-" + id).find("#post-title").text();
        $("#deletepromptmodal").modal("show");
        $("#deletepromptmodal").find("#delete_title").text(title);
        $("#delete_confirm").click(function(){
            $.ajax({
                url: "{% url 'social:ajax_requests' %}",
                type: "POST",
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'id': id,
                    'request_type': 'delete',
                },
                success: function(data){
                    console.log(data)
                    if (data.deleted){
                        $("#post-id-" + id).remove();
                    }
                },
                error: function(data){
                    console.log(data)
                }
            });
            $("#deletepromptmodal").modal("hide");
            $("#delete_message").modal("show");
        });
    }


    // post updation
    function update_to_page(id, data){
        console.log(data);
        $("#post-id-" + id).find("#post-title").text(data.title);
        $("#post-id-" + id).find("#post-text").text(data.text);
        $("#post-id-" + id).find("#post-published").text({{data.published_date|timesince}});
    }


    function update_post(id){
        var title = $("#post-id-" + id).find("#post-title").text().trim();
        var content = $("#post-id-" + id).find("p#post-text").text().trim();
        $("#post-id-" + id).find("#post-text").hide();
        $(".post-update-form").find("#update-post-title").val(title);
        $(".post-update-form").find("#update-post-content").val(content);

        $(".post-update-form").submit(function(event){
            event.preventDefault();
            var title = $(".post-update-form").find("#update-post-title").val().trim();
            var content = $(".post-update-form").find("#update-post-content").val().trim();
            $.ajax({
                url: "{% url 'social:ajax_requests' %}",
                type: "POST",
                data: {
                    'id': id,
                    'title': title,
                    'content': content,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'request_type': 'update',
                },
                success: function(data){
                    if (data.updated){
                        update_to_page(id, data);
                    }
                },
                error: function(data){
                    console.log(data)
                }
            });
            $('.post-update-form').trigger("reset");
            $("#updateModal").modal("hide");
            $("#update_message").modal("show");
            return false;
        });
    }


    // like posts
    function like(id){
        $("#post-id-" + id).find(".like").addClass("likedislikeclass");
            $.ajax({
                    url: "{% url 'social:likedislike-requests' %}",
                    type: "POST",
                    data: {
                        'post_id': id,
                        'action': 'like',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        if (data.dislike){
                            if (data.dislike_count == 0){
                                $("#post-id-" + id).find("#dislike-count").text('');
                            }else{
                                $("#post-id-" + id).find("#dislike-count").text(data.dislike_count);
                            }
                            $("#post-id-" + id).find("#like-count").text(data.like_count);
                            $("#post-id-" + id).find(".undodislike").attr("onclick", "dislike(" + id + ")");
                            $("#post-id-" + id).find(".undodislike").removeClass("likedislikeclass").addClass("dislike");
                        }else{
                            $("#post-id-" + id).find("#like-count").text(data.like_count);
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                });
        $("#post-id-" + id).find(".like").attr("onclick", "undolike(" + id + ")");
        $("#post-id-" + id).find(".like").removeClass("like").addClass("undolike");
    }


    // undolike posts
    function undolike(id){
        $("#post-id-" + id).find(".undolike").removeClass("likedislikeclass");
            $.ajax({
                    url: "{% url 'social:likedislike-requests' %}",
                    type: "POST",
                    data: {
                        'post_id': id,
                        'action': 'dislike',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        if (data.like_count == 0){
                            $("#post-id-" + id).find("#like-count").text('');
                        }else{
                            $("#post-id-" + id).find("#like-count").text(data.like_count);
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                });
        $("#post-id-" + id).find(".undolike").attr("onclick", "like(" + id + ")");
        $("#post-id-" + id).find(".undolike").removeClass("undolike").addClass("like");
    }


    // dislike posts
    function dislike(id){
        $("#post-id-" + id).find(".dislike").addClass("likedislikeclass");
            $.ajax({
                    url: "{% url 'social:dislike-requests' %}",
                    type: "POST",
                    data: {
                        'post_id': id,
                        'action': 'like',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        console.log(data);
                        if (data.like){
                            if (data.like_count == 0){
                                $("#post-id-" + id).find("#like-count").text('');
                            }else{
                                $("#post-id-" + id).find("#like-count").text(data.like_count);
                            }
                            $("#post-id-" + id).find("#dislike-count").text(data.dislike_count);
                            $("#post-id-" + id).find(".undolike").attr("onclick", "like(" + id + ")");
                            $("#post-id-" + id).find(".undolike").removeClass("likedislikeclass").addClass("like");

                        }else{
                            $("#post-id-" + id).find("#dislike-count").text(data.dislike_count);
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                });
        $("#post-id-" + id).find(".dislike").attr("onclick", "undodislike(" + id + ")");
        $("#post-id-" + id).find(".dislike").removeClass("dislike").addClass("undodislike");
    }


    // undodislike posts
    function undodislike(id){
        $("#post-id-" + id).find(".undodislike").removeClass("likedislikeclass");
            $.ajax({
                    url: "{% url 'social:dislike-requests' %}",
                    type: "POST",
                    data: {
                        'post_id': id,
                        'action': 'dislike',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        if (data.dislike_count == 0){
                            $("#post-id-" + id).find("#dislike-count").text("");
                        }else{
                            $("#post-id-" + id).find("#dislike-count").text(data.dislike_count);
                        }
                    },
                    error: function(data){
                        console.log(data);
                    }
                });
        $("#post-id-" + id).find(".undodislike").attr("onclick", "dislike(" + id + ")");
        $("#post-id-" + id).find(".undodislike").removeClass("undodislike").addClass("dislike");
    }


    // closing comment panel
    $('input[name="close-comment"]').click(function(){
        $(this).parent().parent().slideUp();
    });


    $(document).on('mouseenter mouseleave', ".post-div", function(){
        $(this).find(".post-actions").fadeToggle();
    });


    
    $(document).on('click', '.edit-comment', function(){
        var comment = $(this).prev().text().trim();
        $(this).prev().remove();
        $(this).parent().prepend(`
            <textarea style="overflow: hidden; resize: none; padding-left: 0px; width: 100%; border-radius: 25px; padding: 5px 15px; outline: none; border: 1px solid #c2c2c2;" name="edit-comment"></textarea>
        `);
        $(document).find('[name="edit-comment"]').val(comment).focus();
        $(this).remove();

    })

    $(document).on('keydown', '[name="edit-comment"]', function(event){
        var textarea_height = $(this).prop('scrollHeight');
        var comment = $(this).val().trim();
        var comment_id = $(this).parents('.comment-reply-wrapper').find('[name="comment-id"]').val()
        if (textarea_height > 45){
            $(this).css('height', textarea_height);
        }
        if (event.which === 32 && !comment){
            return false;
        }
        if(event.keyCode === 13){
            if (!comment){
                event.preventDefault();
            }else{
                $.ajax({
                    url: "{% url 'social:edit-comment' %}",
                    type: "POST",
                    data: {
                        'comment_id': comment_id,
                        'edited_comment': comment,
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        $(document).find('#comment-id-'+ comment_id).find('.comment-message-container').prepend(`
                            <span class="comment-message" style="padding: 5px 10px; color: #31708f; border-radius: 25px;">${data.edited_comment}</span>
                        `);
                        $('[name="edit-comment"]').parent().append(`
                            <i class="glyphicon glyphicon-pencil edit-comment pointer" style="color: #31708f; font-size: 14px; vertical-align: middle; padding: 5px;" aria-hidden="true"></i>
                        `);
                        $('[name="edit-comment"]').remove();
                    },
                });
                return false;
            }
        }
    })


    $(document).on('click', '.edit-reply', function(){
        var reply = $(this).prev().text().trim();
        $(this).prev().remove();
        $(this).parent().prepend(`
            <textarea style="overflow: hidden; resize: none; padding-left: 0px; width: 100%; border-radius: 25px; padding: 5px 15px; outline: none; border: 1px solid #c2c2c2;" name="edit-reply"></textarea>
        `);
        $(document).find('[name="edit-reply"]').val(reply).focus();
        $(this).remove();
    })

    $(document).on('keydown', '[name="edit-reply"]', function(event){
        var textarea_height = $(this).prop('scrollHeight');
        var reply = $(this).val().trim();
        var reply_id = $(this).parents('.reply-wrapper').find('[name="reply-id"]').val();
        if (textarea_height > 45){
            $(this).css('height', textarea_height);
        }
        if (event.which === 32 && !reply){
            return false;
        }
        if(event.keyCode === 13){
            if (!reply){
                event.preventDefault();
            }else{
                $.ajax({
                    url: "{% url 'social:edit-reply' %}",
                    type: "POST",
                    data: {
                        'reply_id': reply_id,
                        'edited_reply': reply,
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(data){
                        $('[name="edit-reply"]').parent().append(`
                            <i class="glyphicon glyphicon-pencil edit-reply pointer" style="font-size: 14px; vertical-align: middle; color: #31708f; padding: 5px;" aria-hidden="true"></i>
                        `);
                        $(document).find('#reply-id-'+ reply_id).find('.reply-message-container').prepend(`
                            <span class="reply-message" style="padding: 5px 10px; color: #31708f; border-radius: 25px;">${data.edited_reply}</span>
                        `);
                        $('[name="edit-reply"]').remove();
                    },
                    
                });
                return false;
            }
        }
    })


   {% comment %} (function(){
       alert('problem section: autofocusing on comment need to be specific 2.restrict user to type space and submit empty comment/reply. 3. delete reply remaining git push:OKOK');
   }()) {% endcomment %}

</script>

{% endblock %}